â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           WORKER CRASH NOTIFICATION FEATURE - VISUAL SKETCH                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCENARIO 1: WORKER CRASHES DURING JOB EXECUTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CLIENT     â”‚         â”‚    BROKER    â”‚         â”‚   WORKER     â”‚
    â”‚ mainzCli.cpp â”‚         â”‚ mdbroker.hpp â”‚         â”‚ mdwrkapi.cpp â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚                        â”‚
           â”‚ â‘  Submit Job           â”‚                        â”‚
           â”‚ session.send(proc,req) â”‚                        â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚
           â”‚                        â”‚                        â”‚
           â”‚                        â”‚ â‘¡ Dispatch to Worker   â”‚
           â”‚                        â”‚  worker_send(REQUEST)  â”‚
           â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
           â”‚                        â”‚                        â”‚
           â”‚                        â”‚                        â”‚ â‘¢ Processing
           â”‚                        â”‚                        â”‚   plugin->exec()
           â”‚                        â”‚                        â•‘
           â”‚                        â”‚                        â•‘
           â”‚                        â”‚                        â–¼
           â”‚                        â”‚                        âœ— CRASH!
           â”‚                        â”‚                        
           â”‚                        â”‚ â‘£ Heartbeat Timeout    
           â”‚                        â”‚   (7.5 sec expired)    
           â”‚                        â”‚   purge_workers()      
           â”‚                        â”‚   â€¢ Detect dead worker 
           â”‚                        â”‚   â€¢ Recover lost jobs  
           â”‚                        â”‚   â€¢ Re-queue for retry 
           â”‚                        â”‚                        
           â”‚ â‘¤ CRASH NOTIFICATION   â”‚                        
           â”‚   MDPC_WORKER_DIED     â”‚                        
           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        
           â”‚                        â”‚                        
           â–¼                        â”‚                        
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                        
    â”‚  âš ï¸  POPUP WINDOW   â”‚        â”‚                        
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚                        
    â”‚ Worker Crashed!     â”‚        â”‚                        
    â”‚                     â”‚        â”‚                        
    â”‚ A worker processing â”‚        â”‚ â‘¥ Assign to New Worker
    â”‚ your job has        â”‚        â”‚   (if available)       
    â”‚ crashed. Job will   â”‚        â”‚                        
    â”‚ be retried.         â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> NEW WORKER
    â”‚                     â”‚        â”‚                        
    â”‚      [ OK ]         â”‚        â”‚                        
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â–¼                        


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCENARIO 2: NO WORKERS AVAILABLE FOR SERVICE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         
    â”‚   CLIENT     â”‚         â”‚    BROKER    â”‚         (NO WORKERS)
    â”‚ mainzCli.cpp â”‚         â”‚ mdbroker.hpp â”‚         
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         
           â”‚                        â”‚                  
           â”‚ â‘  Submit Job           â”‚                  
           â”‚ session.send(proc,req) â”‚                  
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  
           â”‚                        â”‚                  
           â”‚                        â”‚ â‘¡ Check Workers  
           â”‚                        â”‚   for service    
           â”‚                        â”‚                  
           â”‚                        â”‚   for (worker in m_workers)
           â”‚                        â”‚     if (srv->m_process.contains(worker))
           â”‚                        â”‚                  
           â”‚                        â”‚   Result: EMPTY! 
           â”‚                        â”‚   No capable workers found
           â”‚                        â”‚                  
           â”‚ â‘¢ IMMEDIATE REJECT     â”‚                  
           â”‚   MDPC_NO_WORKERS      â”‚                  
           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  
           â”‚                        â”‚                  
           â–¼                        â”‚                  
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                  
    â”‚  ðŸš« POPUP WINDOW    â”‚        â”‚                  
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚                  
    â”‚ No Workers!         â”‚        â”‚ â‘£ Job Queued     
    â”‚                     â”‚        â”‚   (waiting for   
    â”‚ No workers are      â”‚        â”‚    workers to    
    â”‚ available to        â”‚        â”‚    come online)  
    â”‚ process this job.   â”‚        â”‚                  
    â”‚                     â”‚        â–¼                  
    â”‚ Please start worker â”‚                           
    â”‚ servers and retry.  â”‚                           
    â”‚                     â”‚                           
    â”‚      [ OK ]         â”‚                           
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  KEY COMPONENTS & MODIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. PROTOCOL EXTENSIONS (mdp.hpp)                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚   #define MDPC_WORKER_DIED    (char*)"\010"    // New message type        â”‚
â”‚   #define MDPC_NO_WORKERS     (char*)"\011"    // New message type        â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. BROKER ENHANCEMENTS (mdbroker.hpp)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚   A) purge_workers() [Line 231-261]                                       â”‚
â”‚      â€¢ Track jobs being processed by dying workers                        â”‚
â”‚      â€¢ Call send_worker_crash_notification(job)                           â”‚
â”‚      â€¢ Re-queue failed jobs for retry                                     â”‚
â”‚                                                                            â”‚
â”‚   B) service_dispatch() [Line 286-415]                                    â”‚
â”‚      â€¢ Check if ANY workers can handle service                            â”‚
â”‚      â€¢ If no workers: call send_no_workers_notification()                 â”‚
â”‚                                                                            â”‚
â”‚   C) New Methods:                                                          â”‚
â”‚      â€¢ send_worker_crash_notification(service_call* job)                  â”‚
â”‚        - Build CBOR notification with error details                       â”‚
â”‚        - Send MDPC_WORKER_DIED message to client                          â”‚
â”‚                                                                            â”‚
â”‚      â€¢ send_no_workers_notification(QString client, QString service)      â”‚
â”‚        - Build CBOR notification with error details                       â”‚
â”‚        - Send MDPC_NO_WORKERS message to client                           â”‚
â”‚                                                                            â”‚
â”‚   D) Enhanced service_call Structure:                                     â”‚
â”‚      struct service_call {                                                â”‚
â”‚          QString client;          // Existing                             â”‚
â”‚          int64_t submit_time;     // NEW: Track submission time           â”‚
â”‚          bool client_notified;    // NEW: Prevent duplicate notifications â”‚
â”‚      }                                                                     â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. CLIENT ENHANCEMENTS (mdcliapi.hpp)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚   A) recv() Method [Line 111-144]                                         â”‚
â”‚      â€¢ Parse incoming message                                             â”‚
â”‚      â€¢ Check if CBOR contains "error" field                               â”‚
â”‚      â€¢ If error: call handle_error_notification()                         â”‚
â”‚      â€¢ Return nullptr for error messages (don't treat as reply)           â”‚
â”‚                                                                            â”‚
â”‚   B) New Method:                                                           â”‚
â”‚      virtual void handle_error_notification(QCborMap error)               â”‚
â”‚      â€¢ Parse error type (WORKER_CRASHED / NO_WORKERS)                     â”‚
â”‚      â€¢ Log to console                                                     â”‚
â”‚      â€¢ Can be overridden for GUI popups                                   â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. GUI CLIENT (mainzCli.cpp or new wrapper)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚   class NotifyingMDCli : public mdcli {                                   â”‚
â”‚   protected:                                                               â”‚
â”‚       void handle_error_notification(QCborMap error) override {           â”‚
â”‚           if (error["error"] == "WORKER_CRASHED") {                       â”‚
â”‚               QMessageBox::warning(...);   // âš ï¸ Show popup               â”‚
â”‚           }                                                                â”‚
â”‚           else if (error["error"] == "NO_WORKERS") {                      â”‚
â”‚               QMessageBox::critical(...);  // ðŸš« Show popup               â”‚
â”‚           }                                                                â”‚
â”‚       }                                                                    â”‚
â”‚   };                                                                       â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MESSAGE FORMAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Crash Notification Message (Broker â†’ Client)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚   Frame 0: Client ID         "client-xyz-123"                             â”‚
â”‚   Frame 1: Empty             ""                                           â”‚
â”‚   Frame 2: Protocol Header   "MDPC01_PL"                                  â”‚
â”‚   Frame 3: Service Name      "PluginName"                                 â”‚
â”‚   Frame 4: CBOR Data         {                                            â”‚
â”‚                                "error": "WORKER_CRASHED",                 â”‚
â”‚                                "service": "PluginName",                   â”‚
â”‚                                "message": "Worker crashed. Retrying...",  â”‚
â”‚                                "timestamp": "2025-11-18T15:30:00",       â”‚
â”‚                                "job_id": "job-456"                        â”‚
â”‚                              }                                             â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ No Workers Message (Broker â†’ Client)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚   Frame 0: Client ID         "client-xyz-123"                             â”‚
â”‚   Frame 1: Empty             ""                                           â”‚
â”‚   Frame 2: Protocol Header   "MDPC01_PL"                                  â”‚
â”‚   Frame 3: Service Name      "PluginName"                                 â”‚
â”‚   Frame 4: CBOR Data         {                                            â”‚
â”‚                                "error": "NO_WORKERS",                     â”‚
â”‚                                "service": "PluginName",                   â”‚
â”‚                                "message": "No workers available.",        â”‚
â”‚                                "timestamp": "2025-11-18T15:30:00"        â”‚
â”‚                              }                                             â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  IMPLEMENTATION TIMELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Phase 1: Protocol Extensions (1 hour)
    â”œâ”€ Add MDPC_WORKER_DIED and MDPC_NO_WORKERS constants
    â””â”€ Update protocol documentation

    Phase 2: Broker Modifications (4-6 hours)
    â”œâ”€ Modify purge_workers() for crash detection
    â”œâ”€ Add send_worker_crash_notification()
    â”œâ”€ Modify service_dispatch() for worker checks
    â”œâ”€ Add send_no_workers_notification()
    â””â”€ Enhance service_call structure

    Phase 3: Client Modifications (3-4 hours)
    â”œâ”€ Modify mdcli::recv() for error handling
    â”œâ”€ Add handle_error_notification()
    â””â”€ Create NotifyingMDCli subclass with popups

    Phase 4: Testing (2-3 hours)
    â”œâ”€ Test worker crash scenarios
    â”œâ”€ Test no-worker scenarios
    â””â”€ Test backward compatibility

    TOTAL ESTIMATED TIME: 10-14 hours


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FILE MODIFICATIONS SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ðŸ“ Core/zmq/mdp.hpp
       â€¢ Add 2 new protocol constants
       â€¢ Update command array
       Lines added: ~5

    ðŸ“ Core/zmq/mdbroker.hpp
       â€¢ Modify purge_workers()
       â€¢ Modify service_dispatch()
       â€¢ Add send_worker_crash_notification()
       â€¢ Add send_no_workers_notification()
       â€¢ Enhance service_call structure
       Lines added: ~120

    ðŸ“ Core/zmq/mdcliapi.hpp
       â€¢ Modify recv() method
       â€¢ Add handle_error_notification()
       Lines added: ~40

    ðŸ“ Main/mainzCli.cpp (or new file)
       â€¢ Create NotifyingMDCli subclass
       â€¢ Add QMessageBox popup handlers
       Lines added: ~50

    TOTAL CODE CHANGES: ~215 lines


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BACKWARD COMPATIBILITY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    âœ… Existing clients continue to work unchanged
       â€¢ Timeout mechanism still functions as fallback
       â€¢ recv() returns nullptr on timeout (existing behavior)

    âœ… Broker handles old and new clients simultaneously
       â€¢ New notifications are additional, not replacement
       â€¢ No breaking changes to existing protocol flow

    âœ… Gradual migration path
       â€¢ Update broker first
       â€¢ Update clients at your own pace
       â€¢ Mixed old/new clients supported


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TESTING SCENARIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Test 1: Simulate Worker Crash
    â”œâ”€ Start: Broker + 1 Worker + Client
    â”œâ”€ Action: Submit job, kill worker mid-execution
    â”œâ”€ Expected: Client popup "Worker crashed" within 8 seconds
    â””â”€ Verify: Job re-queued and re-assigned

    Test 2: No Workers Available
    â”œâ”€ Start: Broker + Client (NO workers)
    â”œâ”€ Action: Submit job
    â”œâ”€ Expected: Client popup "No workers" immediately
    â””â”€ Verify: Job queued but not assigned

    Test 3: Worker Recovery
    â”œâ”€ Start: Broker + Client (NO workers), job queued
    â”œâ”€ Action: Start new worker
    â”œâ”€ Expected: Queued job automatically assigned
    â””â”€ Verify: Job completes successfully

    Test 4: Multiple Crashes
    â”œâ”€ Start: Broker + 3 Workers + Client
    â”œâ”€ Action: Submit 10 jobs, kill all workers
    â”œâ”€ Expected: Client notified 10 times
    â””â”€ Verify: All jobs re-queued

    Test 5: Backward Compatibility
    â”œâ”€ Start: New Broker + Old Client (no modifications)
    â”œâ”€ Action: Simulate crash
    â”œâ”€ Expected: Old client timeout after 2.5 sec, no popup
    â””â”€ Verify: No crashes, graceful degradation


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    âœ… FEASIBILITY:          YES - Fully supported by current architecture
    âœ… CODE CHANGES:         Minimal (~215 lines across 4 files)
    âœ… BREAKING CHANGES:     None - Backward compatible
    âœ… PERFORMANCE IMPACT:   Negligible - Async notifications
    âœ… IMPLEMENTATION TIME:  10-14 hours
    âœ… USER EXPERIENCE:      Significantly improved

    The design leverages existing infrastructure:
    â€¢ Heartbeat mechanism already detects crashes
    â€¢ Internal service commands already support custom messages
    â€¢ ZMQ messaging already supports brokerâ†’client communication

    Recommendation: âœ… PROCEED WITH IMPLEMENTATION
