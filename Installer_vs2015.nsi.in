!include MUI2.nsh
# name the installer
OutFile "Checkout_InstallerV@Checkout_VERSION_MAJOR@.@Checkout_VERSION_MINOR@.@Checkout_VERSION_COMPLEMENT@@Checkout_VERSION_RELEASE@.exe"

SetCompressor /FINAL /SOLID lzma
SetCompressorDictSize 8
!define MUI_COMPONENTSPAGE_SMALLDESC ;No value

!insertmacro MUI_PAGE_COMPONENTS
!insertmacro MUI_PAGE_DIRECTORY
!insertmacro MUI_PAGE_INSTFILES

!insertmacro MUI_UNPAGE_CONFIRM
!insertmacro MUI_UNPAGE_INSTFILES

InstallDir "$PROGRAMFILES64\Checkout"

; These are the programs that are needed by ACME Suite.
Section -Prerequisites
  SetOutPath $INSTDIR\Prerequisites

  MessageBox MB_YESNO "Install the Microsoft Visual C++ 2015 Redistribual (x64) - 14 ?" /SD IDYES IDNO endNetCF
    File "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\redist\1033\vcredist_x64.exe"
    ExecWait "$INSTDIR\vcredist_x64.exe"
  endNetCF:

SectionEnd

# default section start; every NSIS script has at least one section.
Section "Main Installer Section"

# define output path
SetOutPath $INSTDIR\bin

# specify file to go in output path
File "@CMAKE_BINARY_DIR@\bin\Release\Checkout.exe"
File "@CMAKE_BINARY_DIR@\bin\Release\CheckoutProcessServer.exe"

CreateDirectory $INSTDIR\bin\Cache

File "@CMAKE_BINARY_DIR@\bin\Release\*.dll"
;File "@CMAKE_BINARY_DIR@\bin\Release\*.manifest"

# define uninstaller name
WriteUninstaller $INSTDIR\uninstaller.exe

# default section end
SectionEnd

Section "Plugin Installer Section"

# define output path
SetOutPath $INSTDIR\bin\plugins
File "@CMAKE_BINARY_DIR@\bin\plugins\Release\*.dll"

;SetOutPath $INSTDIR\bin\Release\accessible
;File "@CMAKE_BINARY_DIR@\bin\Release\accessible\*.dll"

SetOutPath $INSTDIR\bin\platforms
File "@CMAKE_BINARY_DIR@\bin\Release\platforms\*.dll"

SetOutPath $INSTDIR\bin\iconengines
File "@CMAKE_BINARY_DIR@\bin\Release\iconengines\*.dll"

SetOutPath $INSTDIR\bin\imageformats
File "@CMAKE_BINARY_DIR@\bin\Release\imageformats\*.dll"

#SetOutPath $INSTDIR\bin\sqldrivers
#File "@CMAKE_BINARY_DIR@\bin\Release\sqldrivers\*.dll"



SectionEnd

# create a section to define what the uninstaller does.
# the section will always be named "Uninstall"
Section "Uninstall"

# Always delete uninstaller first
Delete $INSTDIR\uninstaller.exe
Delete "$INSTDIR\bin\Release\Checkout.exe"
Delete "$INSTDIR\bin\Release\CheckoutProcessServer.exe"
Delete "$INSTDIR\bin\Release\CheckoutCore.dll"
Delete "$INSTDIR\bin\Release\CheckoutGui.dll"
Delete "$INSTDIR\bin\Release\CheckoutPluginManager.dll"
Delete "$INSTDIR\bin\Release\CheckoutServer.dll"
Delete "$INSTDIR\bin\Release\icudt52.dll"
Delete "$INSTDIR\bin\Release\icuin52.dll"
Delete "$INSTDIR\bin\Release\icuuc52.dll"
Delete "$INSTDIR\bin\Release\opencv_ffmpeg300_64.dll"
Delete "$INSTDIR\bin\Release\opencv_world300.dll"
Delete "$INSTDIR\bin\Release\Qt5Core.dll"
Delete "$INSTDIR\bin\Release\Qt5Gui.dll"
Delete "$INSTDIR\bin\Release\Qt5Network.dll"
Delete "$INSTDIR\bin\Release\Qt5OpenGL.dll"
Delete "$INSTDIR\bin\Release\Qt5Sql.dll"
Delete "$INSTDIR\bin\Release\Qt5Widgets.dll"
Delete "$INSTDIR\bin\Release\Qt5Xml.dll"
Delete "$INSTDIR\bin\Release\Qt5XmlPatterns.dll"
Delete "$INSTDIR\bin\Release\Qt5Concurrent.dll"

# now delete installed file
# Delete $INSTDIR\test.txt

Delete "$INSTDIR\bin\Release\plugins\*.dll"

SectionEnd
